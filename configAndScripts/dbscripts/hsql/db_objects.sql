/* *******************************************************************************************
						GestPymeSOC - DataBase Schemas and Objects Script
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Prefijo MAT_, para tablas maestras que apliquen para cualquier aplicacion ademas de GestPymeSOC,
Prefijo GPT_, para tablas del modelo propio de GestPymeSOC
Prefijo SEGT_, paratablas del modelo de Seguridad Centralizado
----------------------------------------------------------------------------------------------------------------------------
Usar el prefijo ID_, concatenado con el sufijo de la tabla, para columnas de tipo Clave primaria numerica
Ejemplo: Tabla MAT_PAISES, tiene el sufijo "PAISES" por tanto la columna de clave primaria se llama ID_PAIS
----------------------------------------------------------------------------------------------------------------------------
Para columnas que representen codigos estandar establecidos por entidades gubernamentales o como codificacion
propia definida internamente, se usa el prefijo COD_
----------------------------------------------------------------------------------------------------------------------------
Para columnas que hacen referencia a valores cuantitativos, por ejemplo Valor de compra, se usa el prefijo
VLR_, seguido del sufijo correspondiente
******************************************************************************************** */
CREATE CACHED TABLE SEGT_APLICACIONES(
	ID_APLICACION INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_APLICACION VARCHAR(64) NOT NULL,
	NOMBRE VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(256)
);

CREATE CACHED TABLE SEGT_MODULOS(
	ID_MODULO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ID_APLICACION INTEGER NOT NULL,
	ID_MODULO_PADRE INTEGER,
	NOMBRE VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(256),
	CONSTRAINT MODULOS_APLICACION_FK FOREIGN KEY (ID_APLICACION) REFERENCES SEGT_APLICACIONES (ID_APLICACION) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT MODULOS_PADRE_FK FOREIGN KEY (ID_MODULO_PADRE) REFERENCES SEGT_MODULOS (ID_MODULO) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE CACHED TABLE SEGT_RECURSOS(
	ID_RECURSO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ID_APLICACION INTEGER NOT NULL,
	ID_MODULO INTEGER,
	RUTA_RECURSO VARCHAR(256) NOT NULL,
	NOMBRE  VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(256),
	CONSTRAINT RECURS_APLICACION_FK FOREIGN KEY (ID_APLICACION) REFERENCES SEGT_APLICACIONES (ID_APLICACION) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT RECURS_MODULO_FK FOREIGN KEY (ID_MODULO) REFERENCES SEGT_MODULOS (ID_MODULO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT RECURS_RUTA_UK UNIQUE (RUTA_RECURSO)
);

CREATE CACHED TABLE SEGT_ROLES(
	ID_ROL INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ID_APLICACION INTEGER NOT NULL,
	NOMBRE VARCHAR(45) DEFAULT NULL,
	DESCRIPCION VARCHAR(256) DEFAULT NULL,
	CONSTRAINT ROLES_APLICACION_FK FOREIGN KEY (ID_APLICACION) REFERENCES SEGT_APLICACIONES (ID_APLICACION) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT ROLES_NOMBRE_UK UNIQUE (NOMBRE)
);

CREATE CACHED TABLE SEGT_RECURSOS_X_ROLES(
	ID_ROL INTEGER,
	ID_RECURSO INTEGER,
	PRIMARY KEY (ID_ROL, ID_RECURSO),
	CONSTRAINT RECXROL_ROL_FK FOREIGN KEY (ID_ROL) REFERENCES SEGT_ROLES (ID_ROL) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT RECXROL_RECURSO_FK FOREIGN KEY (ID_RECURSO) REFERENCES SEGT_RECURSOS (ID_RECURSO) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE CACHED TABLE SEGT_USUARIOS(
	ID_USUARIO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	LOGIN_ALIAS VARCHAR(30) NOT NULL,
	PASSWORD VARCHAR(128) NOT NULL,
	PASSWORD_SALT VARCHAR(128),
	NOMBRE_COMPLETO VARCHAR(128) NOT NULL,
	FEC_ULTIMO_INGRESO TIMESTAMP,
	IP_ULTIMO_INGRESO VARCHAR(64),
	COD_ISO_IDIOMA VARCHAR(6),
	REINTENTOS_FALLIDOS INTEGER,
	ES_BLOQUEDADO_REINTENTOS VARCHAR(1) NOT NULL,
	FEC_BLOQUEO TIMESTAMP,
	ES_ACTIVO VARCHAR(1) NOT NULL,
	CONSTRAINT USR_LOGIN_UK UNIQUE (LOGIN_ALIAS),
	CONSTRAINT USR_ACTIVO_CK CHECK (ES_ACTIVO IN('N','S')),
	CONSTRAINT USR_ESBLOQU_CK CHECK (ES_BLOQUEDADO_REINTENTOS IN('N','S'))
);

CREATE CACHED TABLE SEGT_ROLES_X_USUARIO(
	ID_USUARIO INTEGER,
	ID_ROL INTEGER,
	PRIMARY KEY (ID_USUARIO,ID_ROL),
	CONSTRAINT ROLXUSR_USR_FK FOREIGN KEY (ID_USUARIO) REFERENCES SEGT_USUARIOS (ID_USUARIO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT ROLXUSR_ROL_FK FOREIGN KEY (ID_ROL) REFERENCES SEGT_ROLES (ID_ROL) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE CACHED TABLE MAT_PAISES(
	ID_PAIS INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	NOMBRE VARCHAR(128) NOT NULL,
	COD_DANE VARCHAR(4) NOT NULL,
	CONSTRAINT PAISES_COD_DANE_UK UNIQUE (COD_DANE)
);

CREATE CACHED TABLE MAT_DEPARTAMENTOS(
	ID_DEPARTAMENTO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_DEPARTAMENTO VARCHAR(3) NOT NULL,
	NOMBRE VARCHAR(128) NOT NULL,
	ID_PAIS INTEGER NOT NULL,
	CONSTRAINT DEPART_IDPAIS_FK FOREIGN KEY (ID_PAIS) REFERENCES MAT_PAISES (ID_PAIS) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT DEPART_COD_UK UNIQUE (ID_PAIS,COD_DEPARTAMENTO)
);

CREATE CACHED TABLE MAT_CIUDADES(
	ID_CIUDAD INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_CIUDAD VARCHAR(4) NOT NULL,
	NOMBRE VARCHAR(128) NOT NULL,
	ID_DEPARTAMENTO INTEGER NOT NULL,
	CONSTRAINT CIUD_IDDEPART_FK FOREIGN KEY (ID_DEPARTAMENTO) REFERENCES MAT_DEPARTAMENTOS (ID_DEPARTAMENTO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT CIUD_COD_UK UNIQUE (ID_DEPARTAMENTO,COD_CIUDAD)
);

CREATE CACHED TABLE MAT_BANCOS(
	ID_BANCO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_BANCO VARCHAR(15),
	NOMBRE VARCHAR(128) NOT NULL,
	ES_VIGENTE VARCHAR(1) DEFAULT 'S' NOT NULL,
	CONSTRAINT BANCO_COD_UK UNIQUE(COD_BANCO),
	CONSTRAINT BANCO_VIGENTE_CK CHECK (ES_VIGENTE IN('N','S'))
);

CREATE CACHED TABLE MAT_DIRECCIONES(
	ID_DIRECCION INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_TIPO_VIA_PPAL VARCHAR(15),
	NUMERO_VIA_PPAL VARCHAR(3),
	LETRAS_VIA_PPAL VARCHAR(3),
	BIS VARCHAR(3),
	NUMERO_BIS VARCHAR(3),
	LETRAS_BIS VARCHAR(3),
	CUADRANTE_VIA_PPAL VARCHAR(10),
	COD_COMPLEM_VIA_PPAL VARCHAR(15),
	DETAL_COMPLEM_VIA_PPAL VARCHAR(40),
	NUMERO_VIA_SECUND VARCHAR(3),
	LETRAS_VIA_SECUND VARCHAR(3),
	NUMERO_VIA_COMPLEM VARCHAR(3),
	CUADRANTE_VIA_COMPLEM VARCHAR(10),
	COD_COMPLEM_VIA_COMPLEM VARCHAR(15),
	DETAL_COMPLEM_VIA_COMPLEM VARCHAR(40)
);

CREATE CACHED TABLE MAT_AGRUPADOR_ESTADOS(
	ID_AGRUPADOR INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_AGRUPADOR VARCHAR(64),
	NOMBRE VARCHAR(128),
	CONSTRAINT AGRUPEST_COD_UK UNIQUE (COD_AGRUPADOR)
);

CREATE CACHED TABLE MAT_ESTADOS(
	ID_ESTADO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ID_AGRUPADOR INTEGER NOT NULL,
	COD_ESTADO VARCHAR(64) NOT NULL,
	NOMBRE VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(256),
	ES_ACTIVO VARCHAR(1) DEFAULT 'S' NOT NULL,
	CONSTRAINT ESTD_AGRUPADOR_FK FOREIGN KEY (ID_AGRUPADOR) REFERENCES MAT_AGRUPADOR_ESTADOS (ID_AGRUPADOR) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT ESTD_COD_UK UNIQUE (COD_ESTADO),
	CONSTRAINT ESTD_ACTIVO_CK CHECK (ES_ACTIVO IN('N','S'))
);

CREATE CACHED TABLE MAT_MAESTRAS(
	ID_MAESTRA INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_MAESTRA VARCHAR(15) NOT NULL,
	NOMBRE VARCHAR(128) NOT NULL,
	CONSTRAINT MAESTR_COD_UK UNIQUE (COD_MAESTRA)
);

CREATE CACHED TABLE MAT_DATOS_MAESTRAS(
	ID_DATO_MAESTRA INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_DATO_MAESTRA VARCHAR(15) NOT NULL,
	ID_MAESTRA INTEGER NOT NULL,
	DESCRIPCION VARCHAR(128) NOT NULL,
	CONSTRAINT DAT_MAESTR_MAESTRA_FK FOREIGN KEY (ID_MAESTRA) REFERENCES MAT_MAESTRAS (ID_MAESTRA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT DAT_MAESTR_COD_UK UNIQUE (ID_MAESTRA,  COD_DATO_MAESTRA)
);

CREATE CACHED TABLE MAT_TIPOS_CONTRIBUYENTE(
	ID_TIPO_CONTRIBUYENTE INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_TIPO_CONTRIBUYENTE VARCHAR(15),
	NOMBRE VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(128),
	RETEFUENTE_RENTA_APLICABLE VARCHAR(1) NOT NULL,
	RETEFUENTE_IVA_APLICABLE VARCHAR(1) NOT NULL,
	RETEFUENTE_ICA_APLICABLE VARCHAR(1) NOT NULL,
	RETEFUENTE_CRE_APLICABLE VARCHAR(1) NOT NULL,
	DECLARA_IVA VARCHAR(1) NOT NULL,
	DECLARA_RENTA VARCHAR(1) NOT NULL,
	DECLARA_ICA VARCHAR(1) NOT NULL,
	DECLARA_CREE VARCHAR(1) NOT NULL,
	CONSTRAINT TIPO_CONTRIB_COD_UK UNIQUE (COD_TIPO_CONTRIBUYENTE),
	CONSTRAINT TIPO_CONTRIB_RRENTA_APLIC_CK CHECK (RETEFUENTE_RENTA_APLICABLE IN('N','S')),
	CONSTRAINT TIPO_CONTRIB_RIVA_APLIC_CK CHECK (RETEFUENTE_IVA_APLICABLE IN('N','S')),
	CONSTRAINT TIPO_CONTRIB_RICA_APLIC_CK CHECK (RETEFUENTE_ICA_APLICABLE IN('N','S')),
	CONSTRAINT TIPO_CONTRIB_RCREE_APLIC_CK CHECK (RETEFUENTE_CRE_APLICABLE IN('N','S')),
	CONSTRAINT TIPO_CONTRIB_DCLRENTA_APLIC_CK CHECK (DECLARA_RENTA IN('N','S')),
	CONSTRAINT TIPO_CONTRIB_DCLIVA_APLIC_CK CHECK (DECLARA_IVA IN('N','S')),
	CONSTRAINT TIPO_CONTRIB_DCLICA_APLIC_CK CHECK (DECLARA_ICA IN('N','S')),
	CONSTRAINT TIPO_CONTRIB_DCLCREE_APLIC_CK CHECK (DECLARA_CREE IN('N','S'))
);

/* *****************************************************
	Grupos Tarifarios que definen las tarifas para las actividades economicas
****************************************************** */
CREATE CACHED TABLE MAT_GRUPOS_TARIFA_ACTI_ECONOM(
	ID_GRUPO_TARIFARIO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_RUBRO_ECONOMICO VARCHAR(64) NOT NULL,
	COD_GRUPO_TARIFARIO VARCHAR(15) NOT NULL,
	NOMBRE VARCHAR(256),
	UVT_GRAVABLE NUMERIC(16,2),
	VLR_TARIFA_X_MIL_VIGENTE NUMERIC(6,3),
	CONSTRAINT GRUPTARIF_COD_UK UNIQUE (COD_GRUPO_TARIFARIO),
	CONSTRAINT GRUPTARIF_RUBRO_CK CHECK (COD_RUBRO_ECONOMICO IN('INDUSTRIAL', 'COMERCIAL', 'SERVICIOS', 'FINANCIERO', 'EXCENTO'))
);

CREATE CACHED TABLE MAT_ACTIVIDADES_ECONOMICAS(
	ID_ACTIVIDAD_ECONOMICA INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ID_GRUPO_TARIFARIO INTEGER NOT NULL,
	COD_ACTIVIDAD_CIIU VARCHAR(15),
	NOMBRE VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(512),
	CONSTRAINT ACTI_ECON_COD_UK UNIQUE (COD_ACTIVIDAD_CIIU),
	CONSTRAINT ACTI_ECON_GRUPO_TAR_FK FOREIGN KEY (ID_GRUPO_TARIFARIO) REFERENCES MAT_GRUPOS_TARIFA_ACTI_ECONOM (ID_GRUPO_TARIFARIO) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE CACHED TABLE MAT_TIPOS_IDENTIFICACION(
	ID_TIPO_IDENTIFICACION INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_TIPO_IDENTIFICACION VARCHAR(15) NOT NULL,
	NOMBRE_CORTO VARCHAR(15) NOT NULL,
	DESCRIPCION VARCHAR(128),
	CONSTRAINT TIPO_IDENT_COD_UK UNIQUE (COD_TIPO_IDENTIFICACION),
	CONSTRAINT TIPO_IDENT_NOMBRE_UK UNIQUE (NOMBRE_CORTO)
);

CREATE CACHED TABLE MAT_GRUPOS_EMPRESARIALES(
	ID_GRUPO_EMPRESARIAL INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	RAZON_SOCIAL VARCHAR(128) NOT NULL,
	IDENTIFICACION_TRIBUTARIA VARCHAR(10) NOT NULL,
	DIGITO_VERIFICACION VARCHAR(1) NOT NULL,
	ID_CIUDAD INTEGER NOT NULL,
	NUM_PBX VARCHAR(15),
	NUM_TELEFONO1 VARCHAR(15),
	NUM_TELEFONO2 VARCHAR(15),
	ID_DIRECCION INTEGER,
	CONSTRAINT GRUP_EMPRE_NIT_UK UNIQUE (IDENTIFICACION_TRIBUTARIA),
	CONSTRAINT GRUP_EMPRE_CIUD_FK FOREIGN KEY (ID_CIUDAD) REFERENCES MAT_CIUDADES (ID_CIUDAD) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT GRUP_EMPRE_DIRECC_FK FOREIGN KEY (ID_DIRECCION) REFERENCES MAT_DIRECCIONES (ID_DIRECCION) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE CACHED TABLE MAT_EMPRESAS(
	ID_EMPRESA INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	RAZON_SOCIAL VARCHAR(128) NOT NULL,
	IDENTIFICACION_TRIBUTARIA VARCHAR(10),
	DIGITO_VERIFICACION INTEGER,
	ID_GRUPO_EMPRESARIAL INTEGER NOT NULL,
	ID_CIUDAD INTEGER NOT NULL,
	NUM_PBX VARCHAR(15),
	NUM_TELEFONO1 VARCHAR(15),
	NUM_TELEFONO2 VARCHAR(15),
	ID_DIRECCION INTEGER,
	ID_TIPO_CONTRIBUYENTE INTEGER NOT NULL,
	ID_ACTIVIDAD_ECONOMICA INTEGER NOT NULL,
	ID_BANCO_CONVENIO_NOMINA INTEGER,
	COD_TIPO_PERIODO_NOMINA VARCHAR(30) NOT NULL,
	CONSTRAINT EMPRE_NIT_UK UNIQUE (IDENTIFICACION_TRIBUTARIA),
	CONSTRAINT EMPRE_TIPOPERIO_CK CHECK (COD_TIPO_PERIODO_NOMINA IN('SEMANAL','QUINCENAL', 'MENSUAL')),
	CONSTRAINT EMPRE_ID_GRUPO_FK FOREIGN KEY (ID_GRUPO_EMPRESARIAL) REFERENCES MAT_GRUPOS_EMPRESARIALES (ID_GRUPO_EMPRESARIAL) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPRE_CIUD_FK FOREIGN KEY (ID_CIUDAD) REFERENCES MAT_CIUDADES (ID_CIUDAD) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPRE_DIRECC_FK FOREIGN KEY (ID_DIRECCION) REFERENCES MAT_DIRECCIONES (ID_DIRECCION) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPRE_TIPO_CONTR_FK FOREIGN KEY (ID_TIPO_CONTRIBUYENTE) REFERENCES MAT_TIPOS_CONTRIBUYENTE (ID_TIPO_CONTRIBUYENTE) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPRE_ACT_ECONOM_FK FOREIGN KEY (ID_ACTIVIDAD_ECONOMICA) REFERENCES MAT_ACTIVIDADES_ECONOMICAS (ID_ACTIVIDAD_ECONOMICA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPRE_BANCO_FK FOREIGN KEY (ID_BANCO_CONVENIO_NOMINA) REFERENCES MAT_BANCOS (ID_BANCO) ON UPDATE NO ACTION ON DELETE NO ACTION
);


/*
 * Conceptos de pago para determinar las tarifas de retenciones
 * durante las diferentes transacciones de salida de dinero. Ej: Comprobantes de Egreso, etc
 */
CREATE CACHED TABLE MAT_CONCEPTOS_PAGO(
	ID_CONCEPTO_PAGO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	NOMBRE VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(128),
	APLICA_EMPLEADOS VARCHAR(1),
	APLICA_PROVEEDORES VARCHAR(1),
	CONSTRAINT COCEPTS_APLICEMPL_CK CHECK (APLICA_EMPLEADOS IN('N','S')),
	CONSTRAINT COCEPTS_APLICPROV_CK CHECK (APLICA_PROVEEDORES IN('N','S'))
);

CREATE CACHED TABLE MAT_CONFIG_RETENCIONES(
	ID_CONFIG_RETENCION INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_TIPO_RETENCION VARCHAR(64) NOT NULL,
	COD_TIPO_PERSONA VARCHAR(64) NOT NULL,
	ID_CONCEPTO_PAGO INTEGER NOT NULL,
	UVT_GRAVABLE NUMERIC(16,2) NOT NULL,
	VLR_TARIFA NUMERIC(6,3) NOT NULL,
	CONSTRAINT CONFRET_CONCEPTO_FK FOREIGN KEY (ID_CONCEPTO_PAGO) REFERENCES MAT_CONCEPTOS_PAGO (ID_CONCEPTO_PAGO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT CONFRET_TIPO_PERS_CK CHECK (COD_TIPO_PERSONA IN('PERSONA_NATURAL','PERSONA_JURIDICA')),
	CONSTRAINT CONFRET_TIPO_RETENC_CK CHECK (COD_TIPO_PERSONA IN('RETEFUENTE_RENTA', 'RETEFUENTE_IVA', 'RETEFUENTE_ICA', 'RETEFUENTE_CREE'))
);

/*
 * Tablas Terceros, donde se almacena informacion comun para todos los terceros independienemente del tipo de tercero y del tipo de persona,
 * esto es: Clientes, Proveedores, Empleados, etc
 */
CREATE CACHED TABLE MAT_TERCEROS(
	ID_TERCERO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ID_CIUDAD INTEGER NOT NULL,
	ID_DIRECCION INTEGER,
	NUM_TELEFONO1 VARCHAR(15) NOT NULL,
	NUM_TELEFONO2 VARCHAR(15),
	COD_TIPO_PERSONA VARCHAR(64),
	ID_TIPO_CONTRIBUYENTE INTEGER NOT NULL,
	ID_ACTIVIDAD_ECONOMICA INTEGER,
	ID_TIPO_IDENTIFICACION INTEGER NOT NULL,
	NUM_IDENTIFICACION VARCHAR(15) NOT NULL,
	RAZON_SOCIAL VARCHAR(128) NOT NULL, /*Para personas naturales se inserta el nombre completo*/
	PRIMER_NOMBRE VARCHAR(128),
	SEGUNDO_NOMBRE VARCHAR(128),
	PRIMER_APELLIDO VARCHAR(128),
	SEGUNDO_APELLIDO VARCHAR(128),
	CONSTRAINT TERC_CIUDAD_FK FOREIGN KEY (ID_CIUDAD) REFERENCES MAT_CIUDADES (ID_CIUDAD) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT TERC_DIRECCION_FK FOREIGN KEY (ID_DIRECCION) REFERENCES MAT_DIRECCIONES (ID_DIRECCION) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT TERC_TIPO_CONTR_FK FOREIGN KEY (ID_TIPO_CONTRIBUYENTE) REFERENCES MAT_TIPOS_CONTRIBUYENTE (ID_TIPO_CONTRIBUYENTE) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT TERC_ACT_ECONOM_FK FOREIGN KEY (ID_ACTIVIDAD_ECONOMICA) REFERENCES MAT_ACTIVIDADES_ECONOMICAS (ID_ACTIVIDAD_ECONOMICA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT TERC_TIPO_ID_FK FOREIGN KEY (ID_TIPO_IDENTIFICACION) REFERENCES MAT_TIPOS_IDENTIFICACION (ID_TIPO_IDENTIFICACION) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT TERC_TIPO_PERS_CK CHECK (COD_TIPO_PERSONA IN('PERSONA_NATURAL','PERSONA_JURIDICA'))
);

CREATE CACHED TABLE MAT_PARAMETROS_CONFIG(
	ID_PARAM_CONFIG INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_PARAM_CONFIG VARCHAR(64) NOT NULL,
	COD_APLICACION VARCHAR(32) NOT NULL,
	DESCRIPCION VARCHAR(128),
	VLR_NUMERICO NUMERIC(16,2),
	VLR_CADENA VARCHAR(256),
	CONSTRAINT PARAMCONF_CODCOF_CODAPP_UK UNIQUE(COD_PARAM_CONFIG,COD_APLICACION),
	CONSTRAINT PARAMCONF_CODAPP_CK CHECK (COD_APLICACION IN('GESTPYMESOC'))
);

CREATE CACHED TABLE MAT_EPSS(
	ID_EPS INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_EPS VARCHAR(15),
	NOMBRE VARCHAR(128) NOT NULL,
	ES_VIGENTE VARCHAR(1) DEFAULT 'S' NOT NULL,
	CONSTRAINT EPS_COD_UK UNIQUE(COD_EPS),
	CONSTRAINT EPS_VIGENTE_CK CHECK (ES_VIGENTE IN('N','S'))
);

CREATE CACHED TABLE MAT_AFPS(
	ID_AFP INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_AFP VARCHAR(15),
	NOMBRE VARCHAR(128) NOT NULL,
	ES_VIGENTE VARCHAR(1) DEFAULT 'S' NOT NULL,
	CONSTRAINT AFP_COD_UK UNIQUE(COD_AFP),
	CONSTRAINT AFP_VIGENTE_CK CHECK (ES_VIGENTE IN('N','S'))
);

CREATE CACHED TABLE MAT_ARLS(
	ID_ARL INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_ARL VARCHAR(15),
	NOMBRE VARCHAR(128) NOT NULL,
	ES_VIGENTE VARCHAR(1) DEFAULT 'S' NOT NULL,
	CONSTRAINT ARL_COD_UK UNIQUE(COD_ARL),
	CONSTRAINT ARL_VIGENTE_CK CHECK (ES_VIGENTE IN('N','S'))
);

CREATE CACHED TABLE MAT_CCFS(
	ID_CCF INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_CCF VARCHAR(15),
	NOMBRE VARCHAR(128) NOT NULL,
	ES_VIGENTE VARCHAR(1) DEFAULT 'S' NOT NULL,
	CONSTRAINT CCF_COD_UK UNIQUE(COD_CCF),
	CONSTRAINT CCF_VIGENTE_CK CHECK (ES_VIGENTE IN('N','S'))
);



CREATE CACHED TABLE GPT_CARGOS(
	ID_CARGO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	COD_CARGO VARCHAR(15) NOT NULL,
	NOMBRE VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(256),
	VLR_SALARIO_BASE NUMERIC(16,2),
	CONSTRAINT CARGOS_COD_UK UNIQUE(COD_CARGO)
);

CREATE CACHED TABLE GPT_MOTIVOS_TERMINAC_CONTRATO(
	ID_MOTIVO_TERMINACION INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	NOMBRE VARCHAR(128) NOT NULL,
	DESCRIPCION VARCHAR(256),
	OBLIGA_INDEMNIZACION VARCHAR(1),
	CONSTRAINT MOT_TERMI_OBLIDEMN_CK CHECK(OBLIGA_INDEMNIZACION IN('N','S'))
);

CREATE CACHED TABLE GPT_EMPLEADOS(
	ID_EMPLEADO INTEGER PRIMARY KEY,
	ID_EPS INTEGER NOT NULL,
	ID_AFP INTEGER NOT NULL,
	ID_ESTADO INTEGER NOT NULL,
	ID_GENERO INTEGER  NOT NULL,
	ID_PROFESION INTEGER,
	ID_EMPRESA  INTEGER NOT NULL,/* PARA EL CASO DE MULTIPLES EMPRESAS CON UN MISMO EMPLEADO PERMITE LA FLEXIBILIDAD DE TENER DIFERENTES CUENTAS DE NOMINA*/
	ID_USUARIO INTEGER,
	CONSTRAINT EMPL_IDTERC_FK FOREIGN KEY (ID_EMPLEADO) REFERENCES MAT_TERCEROS (ID_TERCERO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPL_EPS_FK FOREIGN KEY (ID_EPS) REFERENCES MAT_EPSS (ID_EPS) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPL_AFP_FK FOREIGN KEY (ID_AFP) REFERENCES MAT_AFPS (ID_AFP) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPL_ESTADO_FK FOREIGN KEY (ID_ESTADO) REFERENCES MAT_ESTADOS (ID_ESTADO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPL_GENERO_FK FOREIGN KEY (ID_GENERO) REFERENCES MAT_DATOS_MAESTRAS (ID_DATO_MAESTRA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPL_PROFESION_FK FOREIGN KEY (ID_PROFESION) REFERENCES MAT_DATOS_MAESTRAS (ID_DATO_MAESTRA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPL_EMPR_FK FOREIGN KEY (ID_EMPRESA) REFERENCES MAT_EMPRESAS (ID_EMPRESA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT EMPL_USR_FK FOREIGN KEY (ID_USUARIO) REFERENCES SEGT_USUARIOS (ID_USUARIO) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE CACHED TABLE GPT_CONTRATOS_LABORALES(
	ID_CONTRATO INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ID_EMPRESA	INTEGER NOT NULL,
	ID_EMPLEADO INTEGER NOT NULL,
	ID_CARGO INTEGER NOT NULL,
	VLR_SALARIO_BASE NUMERIC(16,2) NOT NULL,
	ES_VIGENTE VARCHAR(1) NOT NULL,
	ES_SALARIO_INTEGRAL VARCHAR(1) NOT NULL,
	DERECHO_RECARGOS VARCHAR(1) NOT NULL,
	FEC_INICIO DATE NOT NULL,
	FEC_TERMINACION DATE,
	COD_TIPO_TERMINO VARCHAR(15) NOT NULL,
	ID_MOTIVO_TERMINACION INTEGER,
	REPORTA_TIEMPO VARCHAR(1),
	CONSTRAINT CONTRAT_EMPRESA_FK FOREIGN KEY (ID_EMPRESA) REFERENCES MAT_EMPRESAS (ID_EMPRESA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT CONTRAT_EMPLEADO_FK FOREIGN KEY (ID_EMPLEADO) REFERENCES GPT_EMPLEADOS (ID_EMPLEADO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT CONTRAT_CARGO_FK FOREIGN KEY (ID_CARGO) REFERENCES GPT_CARGOS (ID_CARGO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT CONTRAT_MOTIVOTERM_FK FOREIGN KEY (ID_MOTIVO_TERMINACION) REFERENCES GPT_MOTIVOS_TERMINAC_CONTRATO (ID_MOTIVO_TERMINACION) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT CONTRAT_ESVIGENT_CK CHECK(ES_VIGENTE IN('N','S')),
	CONSTRAINT CONTRAT_ESSAL_INTEGR_CK CHECK(ES_SALARIO_INTEGRAL IN('N','S')),
	CONSTRAINT CONTRAT_DERECH_RECARG_CK CHECK(DERECHO_RECARGOS IN('N','S')),
	CONSTRAINT CONTRAT_REPORTT_RECARG_CK CHECK(REPORTA_TIEMPO IN('N','S')),
	CONSTRAINT CONTRAT_TIPOTERMINO_CK CHECK(DERECHO_RECARGOS IN('FIJO','INDEFINIDO')),
)

CREATE CACHED TABLE GPT_PROVEEDORES(
	ID_PROVEEDOR INTEGER PRIMARY KEY,
	
	CONSTRAINT PROVEED_IDTERC_FK FOREIGN KEY (ID_PROVEEDOR) REFERENCES MAT_TERCEROS (ID_TERCERO) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE CACHED TABLE GPT_CLIENTES(
	ID_CLIENTE INTEGER PRIMARY KEY,
	CONSTRAINT CLIENT_IDTERC_FK FOREIGN KEY (ID_CLIENTE) REFERENCES MAT_TERCEROS (ID_TERCERO) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE CACHED TABLE GPT_PERIODO_LIQUID_NOMINA(
	ID_PERIODO_NOMINA INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
	ID_EMPRESA INTEGER NOT NULL,
	DESCRIPCION VARCHAR(128),
	COD_TIPO_PERIODO_NOMINA VARCHAR(30) NOT NULL,
	FEC_INICIO_PERIODO DATE NOT NULL,
	FEC_FIN_PERIODO DATE NOT NULL,
	CONSTRAINT PERINOMI_EMPR_FK FOREIGN KEY (ID_EMPRESA) REFERENCES MAT_EMPRESAS (ID_EMPRESA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT PERINOMI_EMPRFEC_UK UNIQUE(ID_EMPRESA,COD_TIPO_PERIODO_NOMINA,FEC_INICIO_PERIODO,FEC_FIN_PERIODO),
	CONSTRAINT PERINOMI_RANGFECHAS_CK CHECK (FEC_INICIO_PERIODO < FEC_FIN_PERIODO),
	CONSTRAINT PERINOMI_TIPOPERIO_CK CHECK (COD_TIPO_PERIODO_NOMINA IN('SEMANAL','QUINCENAL', 'MENSUAL'))
);

CREATE CACHED TABLE GPT_REPORTE_TIEMPO(
	ID_PERIODO_NOMINA INTEGER NOT NULL,
	ID_EMPLEADO INTEGER NOT NULL,
	FECHA DATE NOT NULL,
	HORA_ENTRADA TIMESTAMP NOT NULL,
	HORA_SALIDA TIMESTAMP NOT NULL,
	ES_TURNO VARCHAR(1),
	COD_TIPO_TURNO VARCHAR(15),
	ES_DESCANSO VARCHAR(1),
	PRIMARY KEY (ID_PERIODO_NOMINA,ID_EMPLEADO,FECHA),
	CONSTRAINT REPORTMP_PERIODO_FK FOREIGN KEY (ID_PERIODO_NOMINA) REFERENCES GPT_PERIODO_LIQUID_NOMINA (ID_PERIODO_NOMINA) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT REPORTMP_EMPLEADO_FK FOREIGN KEY (ID_EMPLEADO) REFERENCES GPT_EMPLEADOS (ID_EMPLEADO) ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT REPORTMP_RANGOHORA_CK CHECK(HORA_ENTRADA < HORA_SALIDA),
	CONSTRAINT REPORTMP_ESTURNO_CK CHECK(ES_TURNO IN('N','S')),
	CONSTRAINT REPORTMP_TIPTURNO_CK CHECK(COD_TIPO_TURNO IN('DIURNO','NOCTURNO')),
	CONSTRAINT REPORTMP_ESDESC_CK CHECK(ES_DESCANSO IN('N','S'))
);

CREATE CACHED TABLE GPT_TABLA_DE_GESTPYMESOC(
	
);

/*
	TIPOS ENUMERADOS
	TIPOS_PERSONA(PERSONA_NATURAL PERSONA_JURIDICA)
	CONCEPTOS_RETENCION_IVA(COMPRAS, SERVICIOS)
	CONCEPTOS_RETENCION_RENTA(COMPRAS, SERVICIOS, ARRENDAMIENTOS)
	TIPOS_RETEFUENTE(RETEFUENTE_RENTA, RETEFUENTE_IVA, RETEFUENTE_ICA, RETEFUENTE_CREE)
	RUBRO_ECONOMICO(INDUSTRIAL, COMERCIAL, SERVICIOS, FINANCIERO, EXCENTO)
	TIPO_TERMINO_CONTRATO(FIJO, INDEFINIDO)
	TIPO_PERIODO_NOMINA(SEMANAL,QUINCENAL, MENSUAL
	TIPO_TURNO_REPORTTIEMPO(DIURNO, NOCTURNO)
*/

